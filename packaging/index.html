<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.124.1"><meta name=generator content="Relearn 5.27.0"><meta name=description content><meta name=author content="Choria Project"><meta name=twitter:card content="summary"><meta name=twitter:title content="Custom Packaging :: Choria Server and Broker"><meta name=twitter:description content><meta property="og:url" content="https://choria-io.github.io/go-choria/packaging/index.html"><meta property="og:site_name" content="Choria Server and Broker"><meta property="og:title" content="Custom Packaging :: Choria Server and Broker"><meta property="og:description" content="Choria binary, being a compiled binary with no external dependencies, needs to be recompiled when adding certain kinds of plugin, changing some default locations or adding your own plugins.
The project provides the tooling to perform these builds and has a compile-time configuration that can be adjusted to local needs.
Requirements The host used to perform the compile need to have Docker on it and be able to fetch the registry."><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><title>Custom Packaging :: Choria Server and Broker</title>
<link href=https://choria-io.github.io/go-choria/packaging/index.xml rel=alternate type=application/rss+xml title="Custom Packaging :: Choria Server and Broker"><link href=https://choria-io.github.io/go-choria/css/fontawesome-all.min.css?1742133410 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://choria-io.github.io/go-choria/css/fontawesome-all.min.css?1742133410 rel=stylesheet></noscript><link href=https://choria-io.github.io/go-choria/css/nucleus.css?1742133410 rel=stylesheet><link href=https://choria-io.github.io/go-choria/css/auto-complete.css?1742133410 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://choria-io.github.io/go-choria/css/auto-complete.css?1742133410 rel=stylesheet></noscript><link href=https://choria-io.github.io/go-choria/css/perfect-scrollbar.min.css?1742133410 rel=stylesheet><link href=https://choria-io.github.io/go-choria/css/fonts.css?1742133410 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://choria-io.github.io/go-choria/css/fonts.css?1742133410 rel=stylesheet></noscript><link href=https://choria-io.github.io/go-choria/css/theme.css?1742133410 rel=stylesheet><link href=https://choria-io.github.io/go-choria/css/theme-choria-relearn.css?1742133410 rel=stylesheet id=R-variant-style><link href=https://choria-io.github.io/go-choria/css/chroma-relearn-light.css?1742133410 rel=stylesheet id=R-variant-chroma-style><link href=https://choria-io.github.io/go-choria/css/variant.css?1742133410 rel=stylesheet><link href=https://choria-io.github.io/go-choria/css/print.css?1742133410 rel=stylesheet media=print><link href=https://choria-io.github.io/go-choria/css/ie.css?1742133410 rel=stylesheet><script src=https://choria-io.github.io/go-choria/js/url.js?1742133410></script><script src=https://choria-io.github.io/go-choria/js/variant.js?1742133410></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://choria-io.github.io/go-choria",window.index_js_url="https://choria-io.github.io/go-choria/index.search.js",window.relearn.themeVariantModifier="",window.variants&&variants.init(["choria-relearn"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support html disableInlineCopyToClipboard" data-url=https://choria-io.github.io/go-choria/packaging/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#requirements>Requirements</a></li><li><a href=#plugins>Plugins</a></li><li><a href=#custom-builds-paths-and-packages>Custom builds, paths and packages</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Custom Packaging</span><meta itemprop=position content="1"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=https://choria-io.github.io/go-choria/adr/001/index.html title="V2 Network Protocol (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=https://choria-io.github.io/go-choria/previews/index.html title="Tech Previews (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=custom-packaging>Custom Packaging</h1><p>Choria binary, being a compiled binary with no external dependencies, needs to be recompiled when adding certain kinds
of plugin, changing some default locations or adding your own plugins.</p><p>The project provides the tooling to perform these builds and has a compile-time configuration that can be adjusted to local
needs.</p><h3 id=requirements>Requirements</h3><p>The host used to perform the compile need to have Docker on it and be able to fetch the <code>registry.choria.io/choria/packager</code> container. You can
build a local version of the Packager using <a href=https://github.com/choria-io/packager rel=external target=_blank>https://github.com/choria-io/packager</a>.</p><p>In general you should only do this if you know what you are doing, have special needs, want custom agents etc.</p><h3 id=plugins>Plugins</h3><p>A number of <a href=https://choria.io/docs/development/server/ rel=external target=_blank>plugins types are supported</a> and we build many in at compile time ourselves.</p><p>The general process is that all the plugins in <code>packager/plugins.yaml</code> will be included in the build, if you want to add
additional plugins you list them in <code>packager/user_plugins.yaml</code>.</p><p>If you wish to remove some default plugins you need to remove them from the <code>packager/plugin.yaml</code>.</p><p>In order to add your own RPC Agent you would list it in <code>packager/user_plugins.yaml</code>:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>acme</span>: <span style=color:#ae81ff>ghe.example.net/backplane/acme_agent</span></span></span></code></pre></div><p>During your CI run <code>go get ghe.example.net/backplane/acme_agent</code> then <code>go generate</code> and start the build:</p><div class="highlight wrap-code"><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>BUILD=foss VERSION=0.26.0acme rake build</code></pre></div><p>Your plugin will now be included in the final build, see <code>choria buildinfo -D</code> for al ist of all
dependencies, which should include your plugin.</p><h3 id=custom-builds-paths-and-packages>Custom builds, paths and packages</h3><p>The <code>choria-io/go-choria</code> repository has <code>packager/buildspec.yaml</code> in it, this defines the binaries and packages to build,
there are also some supporting files to call RPM, Deb etc.</p><p>Lets look at building a custom 64bit Linux binary with different paths and creating an Enterprise Linux 8 RPM.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>flags_map</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Version</span>: <span style=color:#ae81ff>github.com/choria-io/go-choria/build.Version</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>SHA</span>: <span style=color:#ae81ff>github.com/choria-io/go-choria/build.SHA</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>BuildTime</span>: <span style=color:#ae81ff>github.com/choria-io/go-choria/build.BuildDate</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ProvisionJWTFile</span>: <span style=color:#ae81ff>github.com/choria-io/go-choria/build.ProvisionJWTFile</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>acme</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>compile_targets</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>defaults</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>output</span>: <span style=color:#ae81ff>backplane-{{version}}-{{os}}-{{arch}}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>flags</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ProvisionJWTFile</span>: <span style=color:#ae81ff>/etc/acme/backplane/provisioning.jwt</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>pre</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>rm additional_agent_*.go || true</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>rm plugin_*.go || true</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>go generate --run plugin</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>64bit_linux</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>os</span>: <span style=color:#ae81ff>linux</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>arch</span>: <span style=color:#ae81ff>amd64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>packages</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>defaults</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>backplane</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>display_name</span>: <span style=color:#ae81ff>Backplane</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bindir</span>: <span style=color:#ae81ff>/opt/acme/bin</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>etcdir</span>: <span style=color:#ae81ff>/etc/acme/backplane</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>release</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>manage_conf</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>manage_server_preset</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>contact</span>: <span style=color:#ae81ff>Backplane Engineering &lt;backplane@eng.example.com&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>rpm_group</span>: <span style=color:#ae81ff>System Environment/Base</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>server_start_runlevels</span>: <span style=color:#e6db74>&#34;-&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>server_start_order</span>: <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>broker_start_runlevels</span>: <span style=color:#e6db74>&#34;-&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>broker_start_order</span>: <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>el8_64</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>template</span>: <span style=color:#ae81ff>el/el8</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dist</span>: <span style=color:#ae81ff>el8</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>target_arch</span>: <span style=color:#ae81ff>x86_64</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>binary</span>: <span style=color:#ae81ff>64bit_linux</span></span></span></code></pre></div><p>We can now run:</p><div class="highlight wrap-code"><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>BUILD=acme VERSION=0.26.0acme rake build</code></pre></div><p>When you are done you will have:</p><ul><li>an rpm called <code>backplane-0.26.0acme.el8.x86_64.rpm</code></li><li>the binary will be <code>/opt/acme/bin/backplane</code></li><li>config files, log files, services all will be personalized around <code>backplane</code></li><li>it will have a custom path to the <code>provisioning.jwt</code></li></ul><p>A number of things are customizable see the section at the top of the <code>buildspec.yaml</code> and comments in the build file.</p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><img src=https://choria-io.github.io/go-choria/logo.png></div><search><div class="searchbox default-animation"><i class="fas fa-search" title="Search (CTRL+ALT+f)"></i>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></search><script>var contentLangs=[]</script><script src=https://choria-io.github.io/go-choria/js/auto-complete.js?1742133410 defer></script><script src=https://choria-io.github.io/go-choria/js/lunr/lunr.min.js?1742133410 defer></script><script src=https://choria-io.github.io/go-choria/js/lunr/lunr.stemmer.support.min.js?1742133410 defer></script><script src=https://choria-io.github.io/go-choria/js/lunr/lunr.multi.min.js?1742133410 defer></script><script src=https://choria-io.github.io/go-choria/js/search.js?1742133410 defer></script></div><div id=R-homelinks class=default-animation><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/broker/index.html><a class=padding href=https://choria-io.github.io/go-choria/broker/index.html><b>1. </b>Choria Broker</a><ul id=R-subsections-c0d38400b06e01717dd02c1b81bf71f9 class="morespace collapsible-menu"><li data-nav-id=/broker/monitoring/index.html><a class=padding href=https://choria-io.github.io/go-choria/broker/monitoring/index.html><b>1. </b>Monitoring</a></li></ul></li><li data-nav-id=/server/index.html><a class=padding href=https://choria-io.github.io/go-choria/server/index.html><b>2. </b>Choria Server</a><ul id=R-subsections-5ee5c6bb7d28a6dec29b86cffcb6fc0d class="morespace collapsible-menu"><li data-nav-id=/server/monitoring/index.html><a class=padding href=https://choria-io.github.io/go-choria/server/monitoring/index.html><b>1. </b>Monitoring</a></li></ul></li><li data-nav-id=/installation/index.html><a class=padding href=https://choria-io.github.io/go-choria/installation/index.html><b>3. </b>Installation</a></li><li data-nav-id=/configuration/index.html><a class=padding href=https://choria-io.github.io/go-choria/configuration/index.html><b>4. </b>Config Reference</a></li><li data-nav-id=/adr/index.html><a class=padding href=https://choria-io.github.io/go-choria/adr/index.html><b>5. </b>Architecture</a><ul id=R-subsections-55d689b2e177bef7553c466a890920c2 class="morespace collapsible-menu"><li data-nav-id=/adr/001/index.html><a class=padding href=https://choria-io.github.io/go-choria/adr/001/index.html><b>1. </b>V2 Network Protocol</a></li></ul></li><li data-nav-id=/packaging/index.html class=active><a class=padding href=https://choria-io.github.io/go-choria/packaging/index.html><b>6. </b>Custom Packaging</a></li><li data-nav-id=/previews/index.html><a class=padding href=https://choria-io.github.io/go-choria/previews/index.html><b>7. </b>Tech Previews</a><ul id=R-subsections-a62187002d34d68923160090a7e2de50 class="morespace collapsible-menu"><li data-nav-id=/previews/protov2/index.html><a class=padding href=https://choria-io.github.io/go-choria/previews/protov2/index.html><b>1. </b>V2 Protocol & Security</a></li></ul></li></ul></div><div id=R-shortcuts><div class="nav-title padding">More</div><ul class=space><li><a class=padding href=https://github.com/choria-io/go-choria><i class='fab fa-fw fa-github'></i> GitHub</a></li><li><a class=padding href=https://github.com/choria-io/general/discussions><i class='far fa-comments'></i> Discussions</a></li><li><a class=padding href=https://github.com/choria-io/go-choria/issues><i class='far fa-life-ring'></i> Issues</a></li><li><a class=padding href=https://slack.puppet.com/><i class='fab fa-slack'></i> #choria</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=R-select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fa-fw fas fa-language"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Language</label>
<select id=R-select-language onchange="location=this.querySelector(this.value).dataset.url"><option id=R-select-language-en value=#R-select-language-en data-url=https://choria-io.github.io/go-choria/packaging/index.html lang=en-us selected></option></select></div><div class=clear></div></div></li><li id=R-select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Theme</label>
<select id=R-select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=R-select-variant-choria-relearn value=choria-relearn selected>Choria Relearn</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><style>#footer{font-size:13px;height:100px;margin-left:auto;margin-right:auto;padding:2rem 1rem;text-align:center;min-width:230px;max-width:300px}#footer p{margin:0}</style><p>Hosted at <a href=https://github.com/choria-io>GitHub</a> by <a href=https://www.devco.net/>R.I. Pienaar</a></p></div></div></div></aside><script src=https://choria-io.github.io/go-choria/js/clipboard.min.js?1742133410 defer></script><script src=https://choria-io.github.io/go-choria/js/perfect-scrollbar.min.js?1742133410 defer></script><script src=https://choria-io.github.io/go-choria/js/theme.js?1742133410 defer></script></body></html>