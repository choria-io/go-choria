{
  "$schema": "https://choria.io/schemas/mcorpc/ddl/v1/agent.json",
  "metadata": {
    "license": "Apache-2.0",
    "author": "R.I.Pienaar <rip@devco.net>",
    "timeout": 5,
    "name": "scout",
    "version": "0.27.0",
    "url": "https://choria.io",
    "description": "Choria Scout Agent Management API",
    "provider": "golang"
  },
  "actions": [
    {
      "action": "checks",
      "display": "ok",
      "description": "Obtain a list of checks and their current status",
      "input": {},
      "output": {
        "checks": {
          "description": "Details about each check",
          "type": "array",
          "display_as": "Checks"
        }
      }
    },
    {
      "action": "resume",
      "input": {
        "checks": {
          "prompt": "Checks",
          "description": "Check to resume, empty means all",
          "type": "array",
          "optional": true
        }
      },
      "output": {
        "failed": {
          "description": "List of checks that could not be resumed",
          "display_as": "Failed",
          "type": "array"
        },
        "transitioned": {
          "description": "List of checks that were resumed",
          "display_as": "Triggered",
          "type": "array"
        },
        "skipped": {
          "description": "List of checks that was skipped",
          "display_as": "Skipped",
          "type": "array"
        }
      },
      "display": "failed",
      "description": "Resume active checking of one or more checks"
    },
    {
      "action": "maintenance",
      "input": {
        "checks": {
          "prompt": "Checks",
          "description": "Check to pause, empty means all",
          "type": "array",
          "optional": true
        }
      },
      "output": {
        "failed": {
          "description": "List of checks that could not be paused",
          "display_as": "Failed",
          "type": "array"
        },
        "transitioned": {
          "description": "List of checks that were paused",
          "display_as": "Triggered",
          "type": "array"
        },
        "skipped": {
          "description": "List of checks that was skipped",
          "display_as": "Skipped",
          "type": "array"
        }
      },
      "display": "failed",
      "description": "Pause checking of one or more checks"
    },
    {
      "action": "goss_validate",
      "description": "Performs a Goss validation using a specific file",
      "display": "failed",
      "aggregate": [
        {
          "function": "summary",
          "args": [
            "tests",
            {"format":  "%s Tests on %d node(s)"}
          ]
        },
        {
          "function": "summary",
          "args": [
            "failures",
            {"format":  "%s Failed test on %d node(s)"}
          ]
        },
        {
          "function": "summary",
          "args": [
            "success",
            {"format":  "%s Passed tests on %d node(s)"}
          ]
        }
      ],
      "input": {
        "yaml_rules": {
          "prompt": "Gossfile contents",
          "description": "Contents of the Gossfile to validate",
          "type": "string",
          "maxlength": 5120,
          "validation": ".",
          "optional": true
        },
        "file": {
          "prompt": "Goss File",
          "description": "Path to the Goss validation specification",
          "type": "string",
          "maxlength": 256,
          "validation": ".+",
          "optional": true
        },
        "vars": {
          "prompt": "Vars File",
          "description": "Path to a file to use as template variables",
          "type": "string",
          "maxlength": 256,
          "validation": ".+",
          "optional": true
        },
        "yaml_vars": {
          "prompt": "Variables YAML",
          "description": "YAML data to use as variables",
          "type": "string",
          "maxlength": 5120,
          "validation": ".+",
          "optional": true
        }
      },
      "output": {
        "tests": {
          "description": "The number of tests that were run",
          "display_as": "Tests",
          "type": "integer"
        },
        "failures": {
          "description": "The number of tests that failed",
          "display_as": "Failed Tests",
          "type": "integer"
        },
        "runtime": {
          "description": "The time it took to run the tests, in seconds",
          "display_as": "Runtime",
          "type": "integer"
        },
        "success": {
          "description": "Indicates how many tests passed",
          "display_as": "Success",
          "type": "integer"
        },
        "skipped": {
          "description": "Indicates how many tests were skipped",
          "display_as": "Skipped",
          "type": "integer"
        },
        "summary": {
          "description": "A human friendly test result",
          "display_as": "Summary",
          "type": "string"
        },
        "results": {
          "description": "The full test results",
          "display_as": "Results",
          "type": "array"
        }
      }
    },
    {
      "action": "trigger",
      "input": {
        "checks": {
          "prompt": "Checks",
          "description": "Check to trigger, empty means all",
          "type": "array",
          "optional": true
        }
      },
      "output": {
        "failed": {
          "description": "List of checks that could not be triggered",
          "display_as": "Failed",
          "type": "array"
        },
        "transitioned": {
          "description": "List of checks that were triggered",
          "display_as": "Triggered",
          "type": "array"
        },
        "skipped": {
          "description": "List of checks that was skipped",
          "display_as": "Skipped",
          "type": "array"
        }
      },
      "display": "failed",
      "description": "Force an immediate check of one or more checks"
    }
  ]
}
