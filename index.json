[{"content":"Choria Broker is a set of features that, in a fully decentralized setup, is the only central component Choria needs. It is highly available, clustered and very high performance. The messaging layer is based on NATS with a number of Choria specific additions.\nA single Choria Broker can manage 50,000 devices on a low budget compute instance - though a cluster of at least 3 brokers is recommended for availability reasons.\nFeatures  Choria Brokers is the core message passing middleware, this is a managed NATS Core instance Choria Streams is the data streaming solution used by various Choria components, this is a managed NATS JetStream instance Choria Federation Broker connects entirely isolated Choria networks into a federated single network Choria Data Adapters to move data from Choria Broker to other technologies A Choria specific authentication layer  ","description":"","tags":null,"title":"Choria Broker","uri":"/broker/index.html"},{"content":"Choria Broker is just one process running in your server, the command systemctl status choria-broker will show a basic overview of the process running, you should have basic monitoring for the process in place.\nPrometheus Metrics By default, the broker does not expose any monitoring metrics, if you set the plugin.choria.stats_port configuration to a port number it will listen on that port. You can listen on non localhost by setting plugin.choria.stats_address.\nIt will then serve a number of URLs, some from Choria and some from the embedded NATS Server - see NATS Monitoring for detail about those.\n   Path Description     /choria/ Build information, run-time resource use   /choria/metrics Prometheus format metrics    System Account Monitoring NATS and Choria Streams require a System account enabled:\nplugin.choria.network.system.user = system plugin.choria.network.system.password = s3cret This should be set in the Broker configuration and any client who wish to access the broker.\nWe have a basic Dashboard you can use to view these.\nIncluded Checks  Tip All the choria broker server commands are from the embedded NATS CLI and so can be an awkward fit within our CLI hierarchy\n  We include a number of checks in the binary that can be used to monitor various aspects of the service.\n   Command Description     choria broker server check connection Performs a basic network connection and round-trip test of the NATS service   choria broker server check stream Checks the health of individual Choria Streams Streams   choria broker server check meta Checks the health of the overall Choria Streams System   choria broker server check jetstream Checks Choria Streams usage limits   choria broker server check server Checks the health of the embedded NATS Server   choria broker server check kv Checks the health of Choria Key-Value buckets    All of these Checks require the System Account to be enabled in your broker and the client configuration to have the same settings. A custom Choria Client configuration can be set using --choria-config on these commands.\nBy default, these commands act like Nagios checks:\n% choria broker server check js OK JetStream | memory=0B memory_pct=0%;75;90 storage=1942997776B storage_pct=0%;75;90 streams=13 streams_pct=0% consumers=21 consumers_pct=0% % echo $? 0 They can though also output json, prometheus and text formats:\n% choria broker server check js --format text JetStream: OK Check Metrics ╭───────────────┬───────────────┬──────┬────────────────────┬───────────────────╮ │ Metric │ Value │ Unit │ Critical Threshold │ Warning Threshold │ ├───────────────┼───────────────┼──────┼────────────────────┼───────────────────┤ │ memory │ 0.00 │ B │ 0.00 │ 0.00 │ │ memory_pct │ 0.00 │ % │ 90.00 │ 75.00 │ │ storage │ 1942955289.00 │ B │ 0.00 │ 0.00 │ │ storage_pct │ 0.00 │ % │ 90.00 │ 75.00 │ │ streams │ 13.00 │ │ 0.00 │ 0.00 │ │ streams_pct │ 0.00 │ % │ -1.00 │ -1.00 │ │ consumers │ 21.00 │ │ 0.00 │ 0.00 │ │ consumers_pct │ 0.00 │ % │ -1.00 │ -1.00 │ ╰───────────────┴───────────────┴──────┴────────────────────┴───────────────────╯ Reports Several run time reports are included that can show connection states and more, all of these require the System Account.\nList Brokers in the cluster This shows all the connected NATS Servers / Choria Brokers in your cluster and some basic information about them\n$ choria broker server list Broker Connections You can view and search active connections to your brokers, here we limit it to the top-5 by subject, see --help for other options\n% choria broker server report connections --top 5 Add the --account=provisioning option to see connections waiting to be provisioned if enabled.\nStreams Report One can get a overview of Choria Streams backends:\n% choria broker server report jetstream Details Broker Data A wealth of data is available in the Brokers about every connection and every subscription and more, run choria broker server req --help to see a full list.\nGolang Profiling As an advanced option, that should not be enabled by default, one can enable the Golang PProf port to facilitate deep debugging of memory allocations and more. How to use this is out of scope of this document and really only useful for developers.\nplugin.choria.network.pprof_port = 9090 ","description":"","tags":null,"title":"Monitoring","uri":"/broker/monitoring/index.html"},{"content":"Choria Server is designed to not open any listening ports unless its Apple HomeKit integration is enabled.\nWithout any opening ports monitoring it is via a state file that it writes regularly when enabled:\nplugin.choria.status_file_path = /var/log/choria-status.json plugin.choria.status_update_interval = 30 The above configuration will cause the status file to update every 30 seconds. This needs to be enabled for any deep introspection.\nNagios Check A nagios protocol test is included in the command choria tool status, this can check various aspects of the server operation.\n$ choria tool status --status-file /var/log/choria-status.json \\ --disconnected \\ # alerts when the server is not connected to a broker --message-since 1h \\ # must have received RPC requests within the last 1 hour --max-age 1m \\ # Status file may not be older than 1 minute --token-age 24h \\ # Alert 1 day before the token expires --certificate-age 24h \\ # Alert 1 day before the certificate expires --provisioned # Alerts if the server is in provisioned mode Autonomous Agent Check A running instance can check itself using an Autonomous Agent, it will then public Cloud Events about it’s internal state and, optionally, expose it’s state to a local Prometheus Node Exporter via its text file directory.\nwatchers:  - name: check_choria  type: nagios  interval: 5m # checks every 5 minutes, require the status file to be 15 minutes or newer  properties:  builtin: choria_status  token_expire: 1d  # alerts when the token expires soon  pubcert_expire: 1d  # alerts when the certificate expires soon  last_message: 1h  # alerts when no RPC message was received in 1 hour Review the Autonomous Agent section for full detail about these checks.\nIf you have Prometheus Node Exporter running locally with an argument --collector.textfile.directory=/var/lib/node_exporter/textfile set you can configure this path in Choria which would cause the above Autonomous Agent to write status to that directory:\nplugin.choria.prometheus_textfile_directory = /var/lib/node_exporter/textfile Lifecycle Events Choria will publish a number of events in Cloud Events format, these can be observed using choria tool event, this will include start, stop, provisioned etc events from every Choria Server instance.\nSome details about these events are in these blog posts:\n Choria Lifecycle Events Transitioning Events to Cloud Events  ","description":"","tags":null,"title":"Monitoring","uri":"/server/monitoring/index.html"},{"content":"Choria Server is the component that runs on every managed device. It hosts various plugins that can be accessed remotely via a RPC layer.\nIt’s a stable and robust agent designed to run forever with minimal resource overheads on managed devices.\nFeatures  Hosts Choria RPC Agents Hosts Choria Autonomous Agents Hosts foundational technology for Choria Scout Supports optional self-provisioning and enrollment into a Choria network in a IoT device like manner Communicates using a JSON based network protocol with extensive JSON Schemas Deep RBAC integration for Authentication, Authorization and Auditing Supports mTLS or JWT token based security layers with, optional, integration into Enterprise SSO, IAM and systems like Hashicorp Vault Supports Open Policy Agent for Authorization Emits Cloud Events for network management and observability Embeddable in Go applications to provide in-process management for automation backplanes Extensive features related to gathering and streaming of Node Metadata Distributed as RPM, Deb, DMG, MSI across many architectures  ","description":"","tags":null,"title":"Choria Server","uri":"/server/index.html"},{"content":"We distribute an RPM, Debs, MSIs, Exes and Docker containers for the Choria Server and Broker.\nEnterprise Linux We publish RPM releases but also nightly builds to our repositories.\nUsers of our Puppet modules will already have these repositories available.\nRelease [choria_release] name=Choria Orchestrator Releases mirrorlist=http://mirrorlists.choria.io/yum/release/el/$releasever/$basearch.txt enabled=True gpgcheck=True repo_gpgcheck=True gpgkey=https://choria.io/RELEASE-GPG-KEY metadata_expire=300 sslcacert=/etc/pki/tls/certs/ca-bundle.crt sslverify=True Nightly Nightly releases are named and versioned choria-0.99.0.20221109-1.el7.x86_64.rpm where the last part of the version is the date.\n[choria_nightly] name=Choria Orchestrator Nightly mirrorlist=http://mirrorlists.choria.io//yum/nightly/el/$releasever/$basearch.txt enabled=True gpgcheck=True repo_gpgcheck=True gpgkey=https://choria.io/NIGHTLY-GPG-KEY metadata_expire=300 sslcacert=/etc/pki/tls/certs/ca-bundle.crt sslverify=True Debian We publish release packages for Debian systems on our APT repositories:\ndeb mirror://mirrorlists.choria.io/apt/release/debian/bullseye/mirrors.txt debian bullseye Docker There is a docker container choria-io/choria that has releases only.\n","description":"","tags":null,"title":"Installation","uri":"/installation/index.html"},{"content":"This is a list of all known Configuration settings. This list is based on declared settings within the Choria Go code base and so will not cover 100% of settings - plugins can contribute their own settings which are note known at compile time.\n Version Hint Built on 05 Dec 22 16:08 UTC using version 0.26.2\n  Run-time configuration The run-time configuration can be inspected using choria tool config --config /etc/choria/server.cfg, this will show the active configuration.\nSearch and list directives In addition to the full list below you can get configuration information for your version using the CLI:\n% choria tool config security.provider .... Configuration item: plugin.security.provider ║ Value: puppet ║ Data Type: string ║ Validation: enum=puppet,file,pkcs11,certmanager,choria ║ Default: puppet ║ ║ The Security Provider to use ╙─ Data Types A few special types are defined, the rest map to standard Go types\n   Type Description     comma_split A comma separated list of strings, possibly with spaces between   duration A duration such as 1h, 300ms, -1.5h or 2h45m. Valid time units are ns, ms, s, m, h   path_split A list of paths split by a OS specific PATH separator   path_string A path that can include ~ for the users home directory   strings A space separated list of strings   title_string A string that will be stored as a Title String    Index          classesfile collectives   color default_discovery_method   default_discovery_options discovery_timeout   identity libdir   logfile loglevel   main_collective plugin.choria.adapters   plugin.choria.agent_provider.mcorpc.agent_shim plugin.choria.agent_provider.mcorpc.config   plugin.choria.agent_provider.mcorpc.libdir plugin.choria.broker_federation   plugin.choria.broker_network plugin.choria.discovery.broadcast.windowed_timeout   plugin.choria.discovery.external.command plugin.choria.discovery.inventory.source   plugin.choria.federation.cluster plugin.choria.federation.collectives   plugin.choria.federation_middleware_hosts plugin.choria.legacy_lifecycle_format   plugin.choria.machine.store plugin.choria.middleware_hosts   plugin.choria.network.client_hosts plugin.choria.network.client_port   plugin.choria.network.client_signer_cert plugin.choria.network.client_tls_force_required   plugin.choria.network.deny_server_connections plugin.choria.network.gateway_name   plugin.choria.network.gateway_port plugin.choria.network.gateway_remotes   plugin.choria.network.leafnode_port plugin.choria.network.leafnode_remotes   plugin.choria.network.listen_address plugin.choria.network.mapping.names   plugin.choria.network.peer_password plugin.choria.network.peer_port   plugin.choria.network.peer_user plugin.choria.network.peers   plugin.choria.network.pprof_port plugin.choria.network.provisioning.client_password   plugin.choria.network.provisioning.signer_cert plugin.choria.network.public_url   plugin.choria.network.server_signer_cert plugin.choria.network.stream.advisory_replicas   plugin.choria.network.stream.advisory_retention plugin.choria.network.stream.event_replicas   plugin.choria.network.stream.event_retention plugin.choria.network.stream.leader_election_replicas   plugin.choria.network.stream.leader_election_ttl plugin.choria.network.stream.machine_replicas   plugin.choria.network.stream.machine_retention plugin.choria.network.stream.manage_streams   plugin.choria.network.stream.store plugin.choria.network.system.password   plugin.choria.network.system.user plugin.choria.network.tls_timeout   plugin.choria.network.websocket_advertise plugin.choria.network.websocket_port   plugin.choria.network.write_deadline plugin.choria.prometheus_textfile_directory   plugin.choria.puppetca_host plugin.choria.puppetca_port   plugin.choria.puppetdb_host plugin.choria.puppetdb_port   plugin.choria.puppetserver_host plugin.choria.puppetserver_port   plugin.choria.registration.file_content.compression plugin.choria.registration.file_content.data   plugin.choria.registration.file_content.target plugin.choria.registration.inventory_content.compression   plugin.choria.registration.inventory_content.target plugin.choria.require_client_filter   plugin.choria.security.certname_whitelist plugin.choria.security.privileged_users   plugin.choria.security.request_signer.seed_file plugin.choria.security.request_signer.service   plugin.choria.security.request_signer.token_file plugin.choria.security.request_signer.url   plugin.choria.security.server.seed_file plugin.choria.security.server.token_file   plugin.choria.server.provision plugin.choria.server.provision.allow_update   plugin.choria.services.registry.cache plugin.choria.services.registry.store   plugin.choria.srv_domain plugin.choria.ssldir   plugin.choria.stats_address plugin.choria.stats_port   plugin.choria.status_file_path plugin.choria.status_update_interval   plugin.choria.submission.max_spool_size plugin.choria.submission.spool   plugin.choria.use_srv plugin.login.aaasvc.login.url   plugin.nats.credentials plugin.nats.pass   plugin.nats.user plugin.scout.agent_disabled   plugin.scout.goss.denied_local_resources plugin.scout.goss.denied_remote_resources   plugin.scout.overrides plugin.scout.tags   plugin.security.certmanager.alt_names plugin.security.certmanager.api_version   plugin.security.certmanager.issuer plugin.security.certmanager.namespace   plugin.security.certmanager.replace plugin.security.choria.ca   plugin.security.choria.certificate plugin.security.choria.key   plugin.security.choria.seed_file plugin.security.choria.sign_replies   plugin.security.choria.token_file plugin.security.choria.trusted_signers   plugin.security.cipher_suites plugin.security.client_anon_tls   plugin.security.ecc_curves plugin.security.file.ca   plugin.security.file.certificate plugin.security.file.key   plugin.security.issuer.names plugin.security.pkcs11.driver_file   plugin.security.pkcs11.slot plugin.security.provider   plugin.security.server_anon_tls plugin.security.support_legacy_certificates   plugin.yaml registerinterval   registration registration_collective   registration_splay rpcaudit   rpcauthorization rpcauthprovider   rpclimitmethod soft_shutdown_timeout   ttl     classesfile  Type: path_string Default Value: /opt/puppetlabs/puppet/cache/state/classes.txt  Path to a file listing configuration classes applied to a node, used in matches using Class filters\ncollectives  Type: comma_split  The list of known Sub Collectives this node will join or communicate with, Servers will subscribe the node and each agent to each sub collective and Clients will publish to a chosen sub collective. Defaults to the build settin build.DefaultCollectives\ncolor  Type: boolean Default Value: true  Disables or enable CLI color\ndefault_discovery_method  Type: string Validation: enum=mc,broadcast,puppetdb,choria,external,inventory Default Value: mc  The default discovery plugin to use. The default “mc” uses a network broadcast, “choria” uses PuppetDB, external calls external commands\ndefault_discovery_options  Type: strings  Default options to pass to the discovery plugin\ndiscovery_timeout  Type: integer Default Value: 2  How long to wait for responses while doing broadcast discovery\nidentity  Type: string  The identity this machine is known as, when empty it’s derived based on the operating system hostname or by calling facter fqdn\nlibdir  Type: path_split  The directory where Agents, DDLs and other plugins are found\nlogfile  Type: path_string Default Value: stdout  The file to write logs to, when set to ‘discard’ logging will be disabled. Also supports ‘stdout’ and ‘stderr’ as special log destinations.\nloglevel  Type: string Validation: enum=debug,info,warn,error,fatal Default Value: info  The lowest level log to add to the logfile\nmain_collective  Type: string  The Sub Collective where a Client will publish to when no specific Sub Collective is configured\nplugin.choria.adapters  Type: comma_split Additional Information: https://choria.io/docs/adapters/  The list of Data Adapters to activate\nplugin.choria.agent_provider.mcorpc.agent_shim  Type: string  Path to the helper used to call MCollective Ruby agents\nplugin.choria.agent_provider.mcorpc.config  Type: string  Path to the MCollective configuration file used when running MCollective Ruby agents\nplugin.choria.agent_provider.mcorpc.libdir  Type: path_split  Path to the libdir MCollective Ruby agents should have\nplugin.choria.broker_federation  Type: boolean Additional Information: https://choria.io/docs/federation/ Default Value: false  Enables the Federation Broker\nplugin.choria.broker_network  Type: boolean Additional Information: https://choria.io/docs/deployment/broker/ Default Value: false  Enables the Network Broker\nplugin.choria.discovery.broadcast.windowed_timeout  Type: boolean  Enables the experimental dynamic timeout for choria/mc discovery\nplugin.choria.discovery.external.command  Type: path_string  The command to use for external discovery\nplugin.choria.discovery.inventory.source  Type: path_string  The file to read for inventory discovery\nplugin.choria.federation.cluster  Type: string Additional Information: https://choria.io/docs/federation/ Default Value: mcollective  The cluster name a Federation Broker serves\nplugin.choria.federation.collectives  Type: comma_split Additional Information: https://choria.io/docs/federation/ Environment Variable: CHORIA_FED_COLLECTIVE  List of known remote collectives accessible via Federation Brokers\nplugin.choria.federation_middleware_hosts  Type: comma_split Additional Information: https://choria.io/docs/federation/  Middleware brokers used by the Federation Broker, if unset uses SRV\nplugin.choria.legacy_lifecycle_format  Type: boolean Default Value: 0  When enabled will publish lifecycle events in the legacy format, else Cloud Events format is used\nplugin.choria.machine.store  Type: string Additional Information: https://choria.io/docs/autoagents/  Directory where Autonomous Agents are stored\nplugin.choria.middleware_hosts  Type: comma_split  Set specific middleware hosts in the format host:port, if unset uses SRV\nplugin.choria.network.client_hosts  Type: comma_split  CIDRs to limit client connections from, appropriate ACLs are added based on this\nplugin.choria.network.client_port  Type: integer Additional Information: https://choria.io/docs/deployment/broker/ Default Value: 4222  Port the Network Broker will accept client connections on\nplugin.choria.network.client_signer_cert  Type: comma_split  Fully qualified paths to the public certificates used by the AAA Service to sign client JWT tokens. This enables users with signed JWTs to use unverified TLS to connect. Can also be a list of ed25519 public keys.\nplugin.choria.network.client_tls_force_required  Type: boolean  Force requiring/not requiring TLS for all clients\nplugin.choria.network.deny_server_connections  Type: boolean  Set ACLs denying server connections to this broker\nplugin.choria.network.gateway_name  Type: string Default Value: CHORIA  Name for the Super Cluster\nplugin.choria.network.gateway_port  Type: integer Default Value: 0  Port to listen on for Super Cluster connections\nplugin.choria.network.gateway_remotes  Type: comma_split  List of remote Super Clusters to connect to\nplugin.choria.network.leafnode_port  Type: integer Default Value: 0  Port to listen on for Leafnode connections, disabled with 0\nplugin.choria.network.leafnode_remotes  Type: comma_split  Remote networks to connect to as a Leafnode\nplugin.choria.network.listen_address  Type: string Additional Information: https://choria.io/docs/deployment/broker/ Default Value: ::  Address the Network Broker will listen on\nplugin.choria.network.mapping.names  Type: comma_split  List of subject remappings to apply\nplugin.choria.network.peer_password  Type: string  Password to use when connecting to cluster peers\nplugin.choria.network.peer_port  Type: integer Additional Information: https://choria.io/docs/deployment/broker/  Port used to communicate with other local cluster peers\nplugin.choria.network.peer_user  Type: string  Username to use when connecting to cluster peers\nplugin.choria.network.peers  Type: comma_split Additional Information: https://choria.io/docs/deployment/broker/  List of cluster peers in host:port format\nplugin.choria.network.pprof_port  Type: integer Default Value: 0  The port the network broker will listen on for pprof requests\nplugin.choria.network.provisioning.client_password  Type: string  Password the provisioned clients should use to connect\nplugin.choria.network.provisioning.signer_cert  Type: path_string  Path to the public cert that signs provisioning tokens, enables accepting provisioning connections into the provisioning account\nplugin.choria.network.public_url  Type: string  Name:Port to advertise to clients, useful when fronted by a proxy\nplugin.choria.network.server_signer_cert  Type: comma_split  Fully qualified Paths to the public certificates used by the Provisioner Service to sign server JWT tokens. This enables servers with signed JWTs to use unverified TLS to connect. Can also be a list of ed25519 public keys.\nplugin.choria.network.stream.advisory_replicas  Type: integer Default Value: -1  When configuring Stream advisories storage ensure data is replicated in the cluster over this many servers, -1 means count of peers\nplugin.choria.network.stream.advisory_retention  Type: duration Default Value: 168h  When not zero enables retaining Stream advisories in the Stream Store\nplugin.choria.network.stream.event_replicas  Type: integer Default Value: -1  When configuring LifeCycle events ensure data is replicated in the cluster over this many servers, -1 means count of peers\nplugin.choria.network.stream.event_retention  Type: duration Default Value: 24h  When not zero enables retaining Lifecycle events in the Stream Store\nplugin.choria.network.stream.leader_election_replicas  Type: integer Default Value: -1  When configuring Stream based Leader Election storage ensure data is replicated in the cluster over this many servers, -1 means count of peers\nplugin.choria.network.stream.leader_election_ttl  Type: duration Default Value: 1m  The TTL for leader election, leaders must vote at least this frequently to remain leader\nplugin.choria.network.stream.machine_replicas  Type: integer Default Value: -1  When configuring Autonomous Agent event storage ensure data is replicated in the cluster over this many servers, -1 means count of peers\nplugin.choria.network.stream.machine_retention  Type: duration Default Value: 24h  When not zero enables retaining Autonomous Agent events in the Stream Store\nplugin.choria.network.stream.manage_streams  Type: boolean Default Value: 1  When set to zero will disable managing the standard streams on this node\nplugin.choria.network.stream.store  Type: path_string  Enables Streaming data persistence stored in this path\nplugin.choria.network.system.password  Type: string  Password used to access the Choria system account\nplugin.choria.network.system.user  Type: string  Username used to access the Choria system account\nplugin.choria.network.tls_timeout  Type: integer Default Value: 2  Time to allow for TLS connections to establish, increase on slow or very large networks\nplugin.choria.network.websocket_advertise  Type: string Additional Information: https://choria.io/docs/deployment/broker/  The URL to advertise for websocket connections\nplugin.choria.network.websocket_port  Type: integer Additional Information: https://choria.io/docs/deployment/broker/  Port to listen on for websocket connections\nplugin.choria.network.write_deadline  Type: duration Default Value: 10s  How long to allow clients to process traffic before treating them as slow, increase this on large networks or slow networks\nplugin.choria.prometheus_textfile_directory  Type: path_string  Directory where Prometheus Node Exporter textfile collector reads data\nplugin.choria.puppetca_host  Type: string Default Value: puppet  The hostname where your Puppet Certificate Authority can be found\nplugin.choria.puppetca_port  Type: integer Default Value: 8140  The port your Puppet Certificate Authority listens on\nplugin.choria.puppetdb_host  Type: string  The host hosting your PuppetDB, used by the “choria” discovery plugin\nplugin.choria.puppetdb_port  Type: integer Default Value: 8081  The port your PuppetDB listens on\nplugin.choria.puppetserver_host  Type: string Default Value: puppet  The hostname where your Puppet Server can be found\nplugin.choria.puppetserver_port  Type: integer Default Value: 8140  The port your Puppet Server listens on\nplugin.choria.registration.file_content.compression  Type: boolean Default Value: true  Enables gzip compression of registration data\nplugin.choria.registration.file_content.data  Type: string  YAML or JSON file to use as data source for registration\nplugin.choria.registration.file_content.target  Type: string  NATS Subject to publish registration data to\nplugin.choria.registration.inventory_content.compression  Type: boolean Default Value: true  Enables gzip compression of registration data\nplugin.choria.registration.inventory_content.target  Type: string  NATS Subject to publish registration data to\nplugin.choria.require_client_filter  Type: boolean Default Value: false  If a client filter should always be required, only used in Go clients\nplugin.choria.security.certname_whitelist  Type: comma_split Default Value: .mcollective$,.choria$  Patterns of certificate names that are allowed to be clients\nplugin.choria.security.privileged_users  Type: comma_split Additional Information: https://choria.io/docs/configuration/aaa/ Default Value: .privileged.mcollective$,.privileged.choria$  Patterns of certificate names that would be considered privileged and able to set custom callers\nplugin.choria.security.request_signer.seed_file  Type: path_string Additional Information: https://github.com/choria-io/aaasvc  Path to the seed file used to access a Central Authenticator\nplugin.choria.security.request_signer.service  Type: boolean Additional Information: https://choria-io.github.io/aaasvc/  Enables signing requests via Choria RPC requests\nplugin.choria.security.request_signer.token_file  Type: path_string Additional Information: https://github.com/choria-io/aaasvc  Path to the token used to access a Central Authenticator\nplugin.choria.security.request_signer.url  Type: string Additional Information: https://choria-io.github.io/aaasvc/  URL to the Signing Service\nplugin.choria.security.server.seed_file  Type: path_string  The server token seed to use for authentication, defaults to server.seed in the same location as server.conf\nplugin.choria.security.server.token_file  Type: path_string  The server token file to use for authentication, defaults to serer.jwt in the same location as server.conf\nplugin.choria.server.provision  Type: boolean Additional Information: https://choria-io.github.io/provisioner/ Default Value: false  Specifically enable or disable provisioning\nplugin.choria.server.provision.allow_update  Type: boolean Additional Information: https://choria-io.github.io/provisioner/ Default Value: false  Allows the provisioner to perform in-place version updates\nplugin.choria.services.registry.cache  Type: path_string Environment Variable: CHORIA_REGISTRY  Directory where the Registry client stores DDLs found in the registry\nplugin.choria.services.registry.store  Type: path_string  Directory where the Registry service finds DDLs to read\nplugin.choria.srv_domain  Type: string Additional Information: https://choria.io/docs/deployment/dns/  The domain to use for SRV records, defaults to the domain the server FQDN is in\nplugin.choria.ssldir  Type: path_string  The SSL directory, auto detected via Puppet, when specifically set Puppet will not be consulted\nplugin.choria.stats_address  Type: string Default Value: 127.0.0.1  The address to listen on for statistics\nplugin.choria.stats_port  Type: integer Default Value: 0  The port to listen on for HTTP requests for statistics, setting to 0 disables it\nplugin.choria.status_file_path  Type: path_string  Path to a JSON file to write server health information to regularly\nplugin.choria.status_update_interval  Type: integer Default Value: 30  How frequently to write to the status_file_path\nplugin.choria.submission.max_spool_size  Type: integer Default Value: 500  Maximum amount of messages allowed into each priority\nplugin.choria.submission.spool  Type: path_string  Path to a directory holding messages to submit to the middleware\nplugin.choria.use_srv  Type: boolean Additional Information: https://choria.io/docs/deployment/dns/ Default Value: true  If SRV record lookups should be attempted to find Puppet, PuppetDB, Brokers etc\nplugin.login.aaasvc.login.url  Type: strings Additional Information: https://choria-io.github.io/aaasvc/  List of URLs to attempt to login against when the remote signer is enabled\nplugin.nats.credentials  Type: string Environment Variable: MCOLLECTIVE_NATS_CREDENTIALS  The NATS 2.0 credentials to use, required for accessing NGS\nplugin.nats.pass  Type: string Environment Variable: MCOLLECTIVE_NATS_PASSWORD  The password to use when connecting to the NATS server\nplugin.nats.user  Type: string Environment Variable: MCOLLECTIVE_NATS_USERNAME  The user to connect to the NATS server as. When unset no username is used.\nplugin.scout.agent_disabled  Type: boolean  Disables the scout agent\nplugin.scout.goss.denied_local_resources  Type: comma_split  List of resource types to deny for Goss manifests loaded from local disk\nplugin.scout.goss.denied_remote_resources  Type: comma_split Default Value: command  List of resource types to deny when Goss manifests or variables were received over rpc\nplugin.scout.overrides  Type: path_string  Path to a file holding overrides for Scout checks\nplugin.scout.tags  Type: path_string  Path to a file holding tags for a Scout entity\nplugin.security.certmanager.alt_names  Type: comma_split  when using Cert Manager security provider, add these additional names to the CSR\nplugin.security.certmanager.api_version  Type: string Default Value: v1  the API version to call in cert manager\nplugin.security.certmanager.issuer  Type: string  When using Cert Manager security provider, the name of the issuer\nplugin.security.certmanager.namespace  Type: string Default Value: choria  When using Cert Manager security provider, the namespace the issuer is in\nplugin.security.certmanager.replace  Type: boolean Default Value: true  when using Cert Manager security provider, replace existing CSRs with new ones\nplugin.security.choria.ca  Type: path_string  When using choria security provider, the path to the optional Certificate Authority public certificate\nplugin.security.choria.certificate  Type: path_string  When using choria security provider, the path to the optional public certificate\nplugin.security.choria.key  Type: path_string  When using choria security provider, the path to the optional private key\nplugin.security.choria.seed_file  Type: path_string  The path to the seed file\nplugin.security.choria.sign_replies  Type: boolean Default Value: true  Disables signing replies which would significantly trim down the size of replies but would remove the ability to verify signatures or verify message origin\nplugin.security.choria.token_file  Type: path_string  The path to the JWT token file\nplugin.security.choria.trusted_signers  Type: comma_split  Ed25119 public keys of entities allowed to sign client and server JWT tokens in hex encoded format\nplugin.security.cipher_suites  Type: comma_split  List of allowed cipher suites\nplugin.security.client_anon_tls  Type: boolean Default Value: false  Use anonymous TLS to the Choria brokers from a client, also disables security provider verification - only when a remote signer is set\nplugin.security.ecc_curves  Type: comma_split  List of allowed ECC curves\nplugin.security.file.ca  Type: path_string  When using file security provider, the path to the Certificate Authority public certificate\nplugin.security.file.certificate  Type: path_string  When using file security provider, the path to the public certificate\nplugin.security.file.key  Type: path_string  When using file security provider, the path to the private key\nplugin.security.issuer.names  Type: comma_split  List of names of valid issuers this server will accept, set indvidiaul issuer data using plugin.security.issuer..public\nplugin.security.pkcs11.driver_file  Type: path_string Additional Information: https://choria.io/blog/post/2019/09/09/pkcs11/  When using the pkcs11 security provider, the path to the PCS11 driver file\nplugin.security.pkcs11.slot  Type: integer Additional Information: https://choria.io/blog/post/2019/09/09/pkcs11/  When using the pkcs11 security provider, the slot to use in the device\nplugin.security.provider  Type: string Validation: enum=puppet,file,pkcs11,certmanager,choria Default Value: puppet  The Security Provider to use\nplugin.security.server_anon_tls  Type: boolean Default Value: false  Use anonymous TLS to the Choria brokers from a server\nplugin.security.support_legacy_certificates  Type: boolean Default Value: false  Allow certificates without SANs to be used\nplugin.yaml  Type: path_string Default Value: /etc/puppetlabs/mcollective/generated-facts.yaml  Where to look for YAML or JSON based facts\nregisterinterval  Type: integer Default Value: 300  How often to publish registration data\nregistration  Type: comma_split  The plugins used when publishing Registration data, when this is unset or empty sending registration data is disabled\nregistration_collective  Type: string  The Sub Collective to publish registration data to\nregistration_splay  Type: boolean Default Value: true  When true delays initial registration publish by a random period up to registerinterval following registration publishes will be at registerinterval without further splay\nrpcaudit  Type: boolean Additional Information: https://choria.io/docs/configuration/aaa/ Default Value: false  When enabled uses rpcauditprovider to audit RPC requests processed by the server\nrpcauthorization  Type: boolean Additional Information: https://choria.io/docs/configuration/aaa/ Default Value: true  When enables authorization is performed on every RPC request based on rpcauthprovider\nrpcauthprovider  Type: title_string Additional Information: https://choria.io/docs/configuration/aaa/ Default Value: action_policy  The Authorization system to use\nrpclimitmethod  Type: string Validation: enum=first,random Default Value: first  When limiting nodes to a subset of discovered nodes this is the method to use, random is influenced by\nsoft_shutdown_timeout  Type: integer Default Value: 2  The amount of time to allow the server to exit, after this memory and thread dumps will be performed and a force exit will be done\nttl  Type: integer Default Value: 60  How long published messages are allowed to linger on the network, lower numbers have a higher reliance on clocks being in sync\n","description":"","tags":null,"title":"Config Reference","uri":"/configuration/index.html"},{"content":"Choria binary, being a compiled binary with no external dependencies, needs to be recompiled when adding certain kinds of plugin, changing some default locations or adding your own plugins.\nThe project provides the tooling to perform these builds and has a compile-time configuration that can be adjusted to local needs.\nRequirements The host used to perform the compile need to have Docker on it and be able to fetch the choria/packager container. You can build a local version of the Packager using https://github.com/choria-io/packager.\nIn general you should only do this if you know what you are doing, have special needs, want custom agents etc.\nPlugins A number of plugins types are supported and we build many in at compile time ourselves.\nThe general process is that all the plugins in packager/plugins.yaml will be included in the build, if you want to add additional plugins you list them in packager/user_plugins.yaml.\nIf you wish to remove some default plugins you need to remove them from the packager/plugin.yaml.\nIn order to add your own RPC Agent you would list it in packager/user_plugins.yaml:\n--- acme: ghe.example.net/backplane/acme_agent During your CI run go get ghe.example.net/backplane/acme_agent then go generate and start the build:\nBUILD=foss VERSION=0.26.0acme rake build Your plugin will now be included in the final build, see choria buildinfo -D for al ist of all dependencies, which should include your plugin.\nCustom builds, paths and packages The choria-io/go-choria repository has packager/buildspec.yaml in it, this defines the binaries and packages to build, there are also some supporting files to call RPM, Deb etc.\nLets look at building a custom 64bit Linux binary with different paths and creating an Enterprise Linux 8 RPM.\nflags_map:  Version: github.com/choria-io/go-choria/build.Version  SHA: github.com/choria-io/go-choria/build.SHA  BuildTime: github.com/choria-io/go-choria/build.BuildDate  ProvisionJWTFile: github.com/choria-io/go-choria/build.ProvisionJWTFile  acme:  compile_targets:  defaults:  output: backplane-{{version}}-{{os}}-{{arch}}  flags:  ProvisionJWTFile: /etc/acme/backplane/provisioning.jwt  pre:  - rm additional_agent_*.go || true  - rm plugin_*.go || true  - go generate --run plugin   64bit_linux:  os: linux  arch: amd64   packages:  defaults:  name: backplane  display_name: Backplane  bindir: /opt/acme/bin  etcdir: /etc/acme/backplane  release: 1  manage_conf: 1  manage_server_preset: 0  contact: Backplane Engineering \u003cbackplane@eng.example.com\u003e  rpm_group: System Environment/Base  server_start_runlevels: \"-\"  server_start_order: 50  broker_start_runlevels: \"-\"  broker_start_order: 50   el8_64:  template: el/el8  dist: el8  target_arch: x86_64  binary: 64bit_linux We can now run:\nBUILD=acme VERSION=0.26.0acme rake build When you are done you will have:\n an rpm called backplane-0.26.0acme.el8.x86_64.rpm the binary will be /opt/acme/bin/backplane config files, log files, services all will be personalized around backplane it will have a custom path to the provisioning.jwt  A number of things are customizable see the section at the top of the buildspec.yaml and comments in the build file.\n","description":"","tags":null,"title":"Custom Packaging","uri":"/packaging/index.html"},{"content":"","description":"","tags":null,"title":"Categories","uri":"/categories/index.html"},{"content":"","description":"","tags":null,"title":"Tags","uri":"/tags/index.html"}]